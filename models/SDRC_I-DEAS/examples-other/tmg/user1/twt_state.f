      SUBROUTINE USER1(GG,T,C,Q,QD,R,TIME,DT,IT,KODE,NOCON,MAXNO,
     +ICONV,DUM1,DUM2,DTP,TF)
      DIMENSION GG(1),QD(1),T(1),C(1),Q(1),R(1),ICONV(1)
      INTEGER TWTCOLL(250,16),TWTGUN(20,16),TWTEPC(20,16)
      INTEGER NTWTCOL(16),NTWTGUN(16),NTWTEPC(16) 
      INTEGER STATE(16)     
      REAL QCOLL(4),QGUN(4),QEPC(4)
C
      SAVE
C
C     The routine sets the dissipation levels for a set of 16 TWTA's according
C     to the state information in file twtstate.dat. 
C
C     Initialize
C
      IF (IFLAG.NE.-999) THEN
	CALL NAMAR('TWTGE01',TWTCOLL(1,1),NTWTCOL(1))
	CALL NAMAR('TWTGE02',TWTCOLL(1,2),NTWTCOL(2))
	CALL NAMAR('TWTGE03',TWTCOLL(1,3),NTWTCOL(3))
	CALL NAMAR('TWTGE04',TWTCOLL(1,4),NTWTCOL(4))
	CALL NAMAR('TWTGE05',TWTCOLL(1,5),NTWTCOL(5))
	CALL NAMAR('TWTGE06',TWTCOLL(1,6),NTWTCOL(6))
	CALL NAMAR('TWTGE07',TWTCOLL(1,7),NTWTCOL(7))
	CALL NAMAR('TWTGE08',TWTCOLL(1,8),NTWTCOL(8))
	CALL NAMAR('TWTGE09',TWTCOLL(1,9),NTWTCOL(9))
	CALL NAMAR('TWTGE10',TWTCOLL(1,10),NTWTCOL(10))
	CALL NAMAR('TWTGE11',TWTCOLL(1,11),NTWTCOL(11))
	CALL NAMAR('TWTGE12',TWTCOLL(1,12),NTWTCOL(12))
	CALL NAMAR('TWTGE13',TWTCOLL(1,13),NTWTCOL(13))
	CALL NAMAR('TWTGE14',TWTCOLL(1,14),NTWTCOL(14))
	CALL NAMAR('TWTGE15',TWTCOLL(1,15),NTWTCOL(15))
	CALL NAMAR('TWTGE16',TWTCOLL(1,16),NTWTCOL(16))
C	
	CALL NAMAR('TWTGN01',TWTGUN(1,1),NTWTGUN(1))
	CALL NAMAR('TWTGN02',TWTGUN(1,2),NTWTGUN(2))
	CALL NAMAR('TWTGN03',TWTGUN(1,3),NTWTGUN(3))
	CALL NAMAR('TWTGN04',TWTGUN(1,4),NTWTGUN(4))
	CALL NAMAR('TWTGN05',TWTGUN(1,5),NTWTGUN(5))
	CALL NAMAR('TWTGN06',TWTGUN(1,6),NTWTGUN(6))
	CALL NAMAR('TWTGN07',TWTGUN(1,7),NTWTGUN(7))
	CALL NAMAR('TWTGN08',TWTGUN(1,8),NTWTGUN(8))
	CALL NAMAR('TWTGN09',TWTGUN(1,9),NTWTGUN(9))
	CALL NAMAR('TWTGN10',TWTGUN(1,10),NTWTGUN(10))
	CALL NAMAR('TWTGN11',TWTGUN(1,11),NTWTGUN(11))
	CALL NAMAR('TWTGN12',TWTGUN(1,12),NTWTGUN(12))
	CALL NAMAR('TWTGN13',TWTGUN(1,13),NTWTGUN(13))
	CALL NAMAR('TWTGN14',TWTGUN(1,14),NTWTGUN(14))
	CALL NAMAR('TWTGN15',TWTGUN(1,15),NTWTGUN(15))
	CALL NAMAR('TWTGN16',TWTGUN(1,16),NTWTGUN(16))
C		
	CALL NAMAR('TWTPC01',TWTEPC(1,1),NTWTEPC(1))
	CALL NAMAR('TWTPC02',TWTEPC(1,2),NTWTEPC(2))
	CALL NAMAR('TWTPC03',TWTEPC(1,3),NTWTEPC(3))
	CALL NAMAR('TWTPC04',TWTEPC(1,4),NTWTEPC(4))
	CALL NAMAR('TWTPC05',TWTEPC(1,5),NTWTEPC(5))
	CALL NAMAR('TWTPC06',TWTEPC(1,6),NTWTEPC(6))
	CALL NAMAR('TWTPC07',TWTEPC(1,7),NTWTEPC(7))
	CALL NAMAR('TWTPC08',TWTEPC(1,8),NTWTEPC(8))
	CALL NAMAR('TWTPC09',TWTEPC(1,9),NTWTEPC(9))
	CALL NAMAR('TWTPC10',TWTEPC(1,10),NTWTEPC(10))
	CALL NAMAR('TWTPC11',TWTEPC(1,11),NTWTEPC(11))
	CALL NAMAR('TWTPC12',TWTEPC(1,12),NTWTEPC(12))
	CALL NAMAR('TWTPC13',TWTEPC(1,13),NTWTEPC(13))
	CALL NAMAR('TWTPC14',TWTEPC(1,14),NTWTEPC(14))
	CALL NAMAR('TWTPC15',TWTEPC(1,15),NTWTEPC(15))
	CALL NAMAR('TWTPC16',TWTEPC(1,16),NTWTEPC(16))
C
        OPEN(UNIT=20,FILE='twtstate.dat',STATUS='OLD')
        DO 5 I=1,16
          READ(20,*) NTWTA,STATE(I)
 5      CONTINUE
C
        QCOLL(1)=0
        QCOLL(2)=48.6
        QCOLL(3)=58.3
        QCOLL(4)=69.0
        QGUN(1)=0
        QGUN(2)=9.0
        QGUN(3)=9.0
        QGUN(4)=9.0
        QEPC(1)=0
        QEPC(2)=12.0
        QEPC(3)=9.4
        QEPC(4)=8.3
C        
        IFLAG=-999
      ENDIF
C
C    Set the dissipations.
C
      IF (KODE.EQ.1) THEN
        DO 10 J=1,16
          DO 20 I=1,NTWTCOL(J)
            K=TWTCOLL(I,J)
            Q(K)=Q(K)*QCOLL(STATE(J))/100.0
 20       CONTINUE
          DO 30 I=1,NTWTGUN(J)
            K=TWTGUN(I,J)    
            Q(K)=Q(K)*QGUN(STATE(J))/QGUN(2)
 30       CONTINUE
          DO  40 I=1,NTWTEPC(J)
            K=TWTEPC(I,J)
            Q(K)=Q(K)*QEPC(STATE(J))/QEPC(2)
 40       CONTINUE
 10     CONTINUE     
      ENDIF
C
      RETURN
      END
